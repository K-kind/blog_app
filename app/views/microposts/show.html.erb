<% provide :title, @micropost.title %>
<div class="row">
  <div class="col-md-9 main">
    <div class="row clearfix">
      <div class="col-xs-12 col-md-10 col-md-offset-1">
        <%= render 'microposts/micropost_content', micropost: @micropost %>
        <% if current_user?(@micropost.user) %>
          <span><%= link_to "Edit", edit_micropost_path(@micropost), class: "btn btn-success" %></span>
          <span><%= link_to "Destroy", micropost_path(@micropost), method: :delete, data: { confirm: "You sure?"}, class: "btn btn-danger" %></span>
        <% end %>
        <div class="comment-section clearfix">
          <h4>Comments</h4>
          <% if @comments.any? %>
            <div class="comment-box">
              <% @comments.each do |c| %>
                <div class="comment-list">
                  <div class="row">
                    <div class="col-md-2 comment-user">
                      <%= attachment_image_tag c.user, :profile_image, size: "50x50", format: 'jpeg', class: "", fallback: "no_image.png" %>
                      <%= link_to c.user.name, c.user %>
                    </div>
                    <div class="col-md-10 comment-text">
                      <%= simple_format(c.content) %>
                      <p class="comment-id"><%= "ID:#{c.id} | #{c.created_at.strftime("%Y/%m/%d")}" %></p>
                    </div>
                  </div>
                  <% if current_user?(c.user) || admin_user?(current_user) %>
                    <section class="edit-comment-form">
                      <%= form_for [c.micropost, c] do |f| %>
                        <%= render 'shared/error_messages', object: f.object %>
                        <%= f.text_area :content, class: "form-control", rows: 3 %>
                        <%= f.submit 'Update comment', class: "blue-btn comment-btn" %>
                      <% end %>
                    </section>
                    <div class="comment-btns">
                      <span><a href="#" class="btn btn-success edit-comment">Edit</a></span>
                      <span><%= link_to "Destroy", "/microposts/#{c.micropost_id}/comments/#{c.id}", method: :delete, data: { confirm: "You sure?"}, class: "btn btn-danger" %></span>
                    </div>
                  <% end %>
                </div>
              <% end %>
              <%= will_paginate @comments %>
            </div>
          <% end %>
          <% if logged_in? %>
            <%= form_for [@micropost, @comment] do |f| %>
              <%= render 'shared/error_messages', object: f.object %>
              <%= f.text_area :content, class: "form-control", rows: 3, placeholder: "Comment here..." %>
              <%= f.submit 'Submit comment', class: "blue-btn comment-btn" %>
            <% end %>
          <% else %>
            <textarea class="form-control" rows="3" placeholder="コメントにはログインが必要です"></textarea>
            <input type="submit" value="Submit comment" class="blue-btn comment-btn not-active">
          <% end %>
        </div>
        <p class="page-view">PV: <%= @micropost.impressions_count %></p>
        <div>
          <p>
            <% if @micropost.next%>
              <span class="show-next"><%= link_to "←Next (#{@micropost.next.title})", micropost_path(@micropost.next) %></span>
            <% end %>
            <% if @micropost.prev %>
              <span class="show-prev"><%= link_to "Prev (#{@micropost.prev.title})→", micropost_path(@micropost.prev) %></span>
            <% end %>
          </p>
        </div>
      </div>
    </div>
  </div>
  <aside class="col-md-3">
      <%= render 'shared/user_info' %>  
      <%= render 'shared/aside_menu' %>  
  </aside>
</div>